\documentclass[12pt, a4paper, oneside]{article}
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english]{babel}
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage{listings}

\usepackage{pgfplots,pgfplotstable}
\pgfplotsset{compat=1.9}

\usepackage[capposition=top]{floatrow}

\usepackage{xcolor}
\usepackage{varioref}
\usepackage{hyperref}
\usepackage{cleveref}

\title{AIND: Planning Search -- Heuristics Analysis}
\author{Markus Mayer}
\date{\today}

\definecolor{mygreen}{rgb}{0,0.6,0}
\definecolor{mygray}{rgb}{0.5,0.5,0.5}
\definecolor{lightgray}{rgb}{0.97,0.97,0.97}
\definecolor{mauve}{rgb}{0.58,0,0.82}
\definecolor{sepia}{rgb}{0.58,0.1,0.1}

\newcommand{\keyword}[1]{\underline{\textbf{\textsc{#1}}}}
\newcommand{\keywordb}[1]{\textbf{\textsc{#1}}}
\newcommand{\literal}[1]{{\color{sepia}{\textsc{#1}}}}

\lstdefinelanguage{planning}
{
    keywords={
        Action,
        Init,
        Goal
    },
    morekeywords={[2]},
    morekeywords={[3]
        Precond,
        Effect,
    },
    morekeywords={[4]
        Cargo,
        Plane,
        Airport,
        At,
        In,
        Load,
        Unload,
        Fly},
    comment=[l]{\;},
    sensitive=true,
    extendedchars=true,
    literate={∧}{{\textcolor{mauve}{\ensuremath\wedge}}}1 {¬}{{\textcolor{red}{\ensuremath\lnot}}}1
}[keywords, comments]

\lstset{ %
  backgroundcolor=\color{lightgray},
  basicstyle=\footnotesize,
  breakatwhitespace=false,
  breaklines=true,
  captionpos=t,
  commentstyle=\color{mygreen},
  deletekeywords={...},
  escapeinside={\%*}{*)},
  extendedchars=true,
  frame=none,
  keepspaces=true,
  keywordstyle=\color{blue}\keyword,
  keywordstyle=[3]\color{blue}\keywordb,
  keywordstyle=[4]\literal,
  language=planning,
  morekeywords={*,...},
  numbers=left,
  numbersep=5pt,
  numberstyle=\tiny\color{mygray},
  rulecolor=\color{black},
  showspaces=false,
  showstringspaces=false,
  showtabs=false,
  stringstyle=\color{mymauve},
  tabsize=4,
  title=\lstname
}

\begin{document}

\maketitle

%\begin{abstract}
%\ldots
%\end{abstract}


\section{Problems and optimal plans}
The three planning problems take place in the Air Cargo domain that consists of
the object literals \literal{Cargo}, \literal{Plane} and \literal{Airport},
the propositions \literal{At} and \literal{In} as well as the actions
defined in \cref{lst:aircargo}.

\begin{lstlisting}[caption=Air Cargo Action Schema,label=lst:aircargo]
Action(Load(c, p, a),
    Precond: At(c, a) ∧ At(p, a) 
           ∧ Cargo(c) ∧ Plane(p) ∧ Airport(a)
    Effect: ¬ At(c, a) ∧ In(c, p))
    
Action(Unload(c, p, a),
    Precond: In(c, p) ∧ At(p, a) 
           ∧ Cargo(c) ∧ Plane(p) ∧ Airport(a)
    Effect: At(c, a) ∧ ¬ In(c, p))
    
Action(Fly(p, from, to),
    Precond: At(p, from) 
           ∧ Plane(p) ∧ Airport(from) ∧ Airport(to)
    Effect: ¬ At(p, from) ∧ At(p, to))
\end{lstlisting}

\paragraph{Problem 1:} The first planning problem using two cargo items, planes and airports is defined in \cref{lst:problem1}. An optimal plan to it consists of $6$ actions and is shown in \cref{lst:problem1_plan}. Since the planner does not know about durations,
it cannot reason about the order of \literal{Fly} and \literal{Unload} operations that
are indipendent across airplanes: It might be more efficient to schedule all \literal{Fly}
actions before all \literal{Unload}s, because there is no need to wait for a plane to unload
for another to start flying; however, none of that is encoded in the problem domain.
Metrics for the different planning strategies are listed in \cref{tab:problem1_metrics} \vpageref{tab:problem1_metrics}.

\begin{lstlisting}[caption=Problem 1 initial state and goal,label=lst:problem1]
Init(At(C1, SFO) ∧ At(C2, JFK) 
   ∧ At(P1, SFO) ∧ At(P2, JFK) 
   ∧ Cargo(C1) ∧ Cargo(C2) 
   ∧ Plane(P1) ∧ Plane(P2)
   ∧ Airport(JFK) ∧ Airport(SFO))
Goal(At(C1, JFK) ∧ At(C2, SFO))
\end{lstlisting}

\begin{lstlisting}[caption=Problem 1 optimal plan,label=lst:problem1_plan]
Load(C1, P1, SFO)
Load(C2, P2, JFK)
Fly(P2, JFK, SFO)
Unload(C2, P2, SFO)
Fly(P1, SFO, JFK)
Unload(C1, P1, JFK)
\end{lstlisting}

\paragraph{Problem 2:} The second planning problem uses three cargo items, planes and airports and is defined in \cref{lst:problem2}. An optimal plan to it consists of $9$ actions and is shown in \cref{lst:problem2_plan}.
Metrics for the different planning strategies are listed in \cref{tab:problem2_metrics} \vpageref{tab:problem2_metrics}.

\begin{lstlisting}[caption=Problem 2 initial state and goal,label=lst:problem2]
Init(At(C1, SFO) ∧ At(C2, JFK) ∧ At(C3, ATL) 
   ∧ At(P1, SFO) ∧ At(P2, JFK) ∧ At(P3, ATL) 
   ∧ Cargo(C1) ∧ Cargo(C2) ∧ Cargo(C3)
   ∧ Plane(P1) ∧ Plane(P2) ∧ Plane(P3)
   ∧ Airport(JFK) ∧ Airport(SFO) ∧ Airport(ATL))
Goal(At(C1, JFK) ∧ At(C2, SFO) ∧ At(C3, SFO))
\end{lstlisting}

\begin{lstlisting}[caption=Problem 2 optimal plan,label=lst:problem2_plan]
Load(C1, P1, SFO)
Load(C2, P2, JFK)
Load(C3, P3, ATL)
Fly(P2, JFK, SFO)
Unload(C2, P2, SFO)
Fly(P1, SFO, JFK)
Unload(C1, P1, JFK)
Fly(P3, ATL, SFO)
Unload(C3, P3, SFO)
\end{lstlisting}

\paragraph{Problem 3:} The third and last planning problem uses four cargo items and airports with only two planes; it is defined in \cref{lst:problem3}. An optimal plan to it consists of $12$ actions and is shown in \cref{lst:problem3_plan}.
In this plan, plane \textsc{P2} is loaded with both cargo \textsc{C2} and \textsc{C4} at
the airports \textsc{JFK} (\cref{lst:p3_1st_load}) and \textsc{ORD} (\cref{lst:p3_2nd_load}) respectively, and both are then flown to \textsc{SFO} (\cref{lst:p3_fly}).
This is a valid plan, as an airplane does not have to be empty in order to be \literal{Load}ed,
according to the preconditions of that action. If required, the behavior of flying
only single cargos could be achieved by placing a virtual \textsc{Empty} cargo into the plane,
similar to the \textsc{Empty} block of the 8-Puzzle domain.
Metrics for the different planning strategies are listed in \cref{tab:problem3_metrics} \vpageref{tab:problem3_metrics}.

\begin{lstlisting}[caption=Problem 3 initial state and goal,label=lst:problem3]
Init(At(C1, SFO) ∧ At(C2, JFK) ∧ At(C3, ATL) ∧ At(C4, ORD) 
   ∧ At(P1, SFO) ∧ At(P2, JFK) 
   ∧ Cargo(C1) ∧ Cargo(C2) ∧ Cargo(C3) ∧ Cargo(C4)
   ∧ Plane(P1) ∧ Plane(P2)
   ∧ Airport(JFK) ∧ Airport(SFO) ∧ Airport(ATL) ∧ Airport(ORD))
Goal(At(C1, JFK) ∧ At(C3, JFK) ∧ At(C2, SFO) ∧ At(C4, SFO))
\end{lstlisting}

\begin{lstlisting}[caption=Problem 3 optimal plan,label=lst:problem3_plan]
Load(C1, P1, SFO)
Load(C2, P2, JFK) ; 1st load to P2 %* \label{lst:p3_1st_load} *)
Fly(P2, JFK, ORD) ; P2 carries C2
Load(C4, P2, ORD) ; 2nd load to P2 %* \label{lst:p3_2nd_load} *)
Fly(P1, SFO, ATL)
Load(C3, P1, ATL)
Fly(P1, ATL, JFK)
Unload(C1, P1, JFK)
Unload(C3, P1, JFK)
Fly(P2, ORD, SFO) ; P2 carries C2 and C4 %* \label{lst:p3_fly} *)
Unload(C2, P2, SFO)
Unload(C4, P2, SFO)
\end{lstlisting}

\section{Uninformed and informed planning}

\paragraph{Non-heuristic algorithms:} The non-heuristic strategies used
were \href{https://github.com/sunsided/aima-pseudocode/blob/master/md/Breadth-First-Search.md}{\textit{Breadth-first}} and \href{https://github.com/sunsided/aima-pseudocode/blob/master/md/Tree-Search-and-Graph-Search.md}{\textit{Breadth-first Tree}} (tree search using a FIFO queue-based frontier),
\href{https://github.com/sunsided/aima-pseudocode/blob/master/md/Tree-Search-and-Graph-Search.md}{\textit{Depth-first Graph}} (graph search using a stack-based frontier), \href{https://github.com/sunsided/aima-pseudocode/blob/master/md/Depth-Limited-Search.md}{\textit{Depth-limited}} and \href{https://github.com/sunsided/aima-pseudocode/blob/master/md/Uniform-Cost-Search.md}{\textit{Uniform cost}} (best-first graph using the path cost as the score) search.

\paragraph{Heuristic algorithms:} The heuristic strategies used
were \href{https://github.com/sunsided/aima-pseudocode/blob/master/md/Recursive-Best-First-Search.md}{\textit{Recursive best-first}}, \textit{Greedy best-first} (best-first search using the heuristic as the score) and \textit{A*} (best-first with the sum of path cost and heuristic as the score) searches with 
\textit{Constant cost (H1)} (every action has a cost heuristic of $1$), \textit{Precondition ignoring} (every action is applicable) and \textit{\href{https://github.com/sunsided/aima-pseudocode/blob/master/md/GraphPlan.md}{Planning Graph} Level-sum} heuristics.

\pgfplotstableset{col sep=comma,
%      fixed,
%      precision=4,
	  column type={>{\fontseries{bx}\selectfont}l},
	  every head row/.style={after row=\hline},
	  postproc cell content/.append style={
/pgfplots/table/@cell content/.add={\fontseries{\seriesdefault}\selectfont}{}},
      columns/Algorithm/.style={string type},
      columns/New Nodes/.style={column name=New nodes},
      columns/Goal Tests/.style={column name=Goal tests},
      columns/Plan length/.style={column name=Length},
      columns={Algorithm,Expansions,Goal Tests,New Nodes,Plan length,Duration (s)},
      postproc cell content/.append style={
/pgfplots/table/@cell content/.add={\fontseries{\seriesdefault}\selectfont}{}}
      }

\begin{table*}[hp]
\pgfplotstabletypeset{metrics_1.csv}
\caption{Metrics for problem 1}
\floatfoot{The optimal plan length for this problem is $6$ actions.}
\label{tab:problem1_metrics}
\end{table*}

\begin{table*}[hp]
\pgfplotstabletypeset{metrics_2.csv}
\caption{Metrics for problem 2}
\floatfoot{The optimal plan length for this problem is $9$ actions.Two of the ten heuristics could not be measured,
because the execution time of the planner exceeded six hours.}
\label{tab:problem2_metrics}
\end{table*}

\begin{table*}[hp]
\centering
\pgfplotstabletypeset{metrics_3.csv}
\caption{Metrics for problem 3}
\floatfoot{The optimal plan length for this problem is $12$ actions.
Three of the ten heuristics could not be measured,
because the execution time of the planner exceeded six hours.}
\label{tab:problem3_metrics}
\end{table*}

\end{document}
